# ç”µå•†è¯„ä»·å¾®æœåŠ¡ç³»ç»Ÿï¼ˆBiz Review Systemï¼‰

[![Go](https://img.shields.io/badge/Go-1.22+-00ADD8?logo=go)](https://golang.org)  
[![Kratos](https://img.shields.io/badge/Kratos-v2.7.0-3498db)](https://go-kratos.dev)  
[![License](https://img.shields.io/badge/License-MIT-blue.svg)]()

---

## é¡¹ç›®æ€§è´¨ï¼šè¯¾ç¨‹é¡¹ç›®é‡æ„

æœ¬é¡¹ç›®æºè‡ª **[ä¸ƒç±³è¯¾å ‚å¾®æœåŠ¡å®æˆ˜è¯¾ç¨‹](https://github.com/Q1mi/go-micro-service-and-cloud-native-course)** çš„ç”µå•†è¯„ä»·ç³»ç»Ÿï¼Œ**åœ¨ä¿ç•™åŸå§‹ CQRS æ¶æ„æ€æƒ³çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†æ·±åº¦é‡æ„ä¸åŠŸèƒ½å¢å¼º**ï¼Œä½¿å…¶å…·å¤‡ç”Ÿäº§ç¯å¢ƒéœ€æ±‚åŠŸèƒ½ã€‚

---

## é¡¹ç›®æ¶æ„

![é¡¹ç›®æ¶æ„å›¾](https://raw.githubusercontent.com/STAR0903/go/main/%E5%BE%AE%E6%9C%8D%E5%8A%A1/image/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20251211022400_53_72.png)

---

## ç³»ç»ŸåŠŸèƒ½å…¨æ™¯

- **C ç«¯ï¼ˆç”¨æˆ·ï¼‰**
  - å‘è¡¨è¯„ä»·ï¼ˆå›¾æ–‡/è§†é¢‘ã€å¤šç»´è¯„åˆ†ã€æ ‡ç­¾ï¼‰
  - **é«˜æ€§èƒ½æŸ¥è¯¢å•†å“è¯„ä»·åˆ—è¡¨**
  - æŸ¥çœ‹ä¸ªäººè¯„ä»·

- **B ç«¯ï¼ˆå•†å®¶ï¼‰**
  - æŸ¥çœ‹æœ¬åº—è¯„ä»·ã€å›å¤ç”¨æˆ·ã€ç”³è¯‰æ¶æ„è¯„ä»·

- **O ç«¯ï¼ˆè¿è¥ï¼‰**
  - å®¡æ ¸è¯„ä»·ä¸ç”³è¯‰ã€ç®¡ç†çŠ¶æ€ã€æ·»åŠ è¿è¥å¤‡æ³¨

- **Job æœåŠ¡**
  - æ¶ˆè´¹ Canal Binlog äº‹ä»¶ â†’ **æ„å»ºä¸‰è¡¨åˆä¸€ ES å®½è¡¨** 
  - ä¿éšœæ•°æ®æœ€ç»ˆä¸€è‡´æ€§

---

## é‡æ„é‡ç‚¹

| ç»´åº¦ | åŸè¯¾ç¨‹é¡¹ç›®   | æœ¬é¡¹ç›®é‡æ„å¢å¼º                                                               |
|------|---------|-----------------------------------------------------------------------|
| **ES æ•°æ®æ¨¡å‹** | æ—        | âœ… è®¾è®¡å¹¶è½åœ° **ä¸‰è¡¨åˆä¸€å®½è¡¨**ï¼ˆè¯„ä»· + å›å¤ + ç”³è¯‰ï¼‰                                      |
| **ES æŸ¥è¯¢èƒ½åŠ›** | ä»…åº—é“ºIDæŸ¥è¯¢ | âœ… æ”¯æŒ **å¤šæ¡ä»¶è¿‡æ»¤ï¼ˆSPUã€è¯„ä»·çŠ¶æ€ã€æ—¶é—´èŒƒå›´ã€çƒ­ç‚¹å…³é”®è¯ï¼‰ã€å…¨æ–‡æ£€ç´¢ã€æ·±åº¦åˆ†é¡µï¼ˆ`search_after`ï¼‰ã€ç»¼åˆæ’åºã€èšåˆ** |
| **CDC åŒæ­¥é“¾è·¯** | ç®€é™‹é€»è¾‘    | âœ… é€šè¿‡ **Canal + Kafka + Job** å®ç° **è¿‘å®æ—¶ã€å¯é ã€å¹‚ç­‰** çš„ MySQL â†’ ES åŒæ­¥         |
| **ä¸­æ–‡æœç´¢** | æœªå¤„ç†     | âœ… é…ç½® **ik åˆ†è¯å™¨**ï¼Œæ”¯æŒè¯„ä»·å†…å®¹ä¸­æ–‡å…¨æ–‡æ£€ç´¢                                          |
| **é«˜å¹¶å‘ä¼˜åŒ–** | åŸºç¡€ç¼“å­˜    | âœ… **Redis + singleflight** é˜²å‡»ç©¿                                        | 

---



## æ ¸å¿ƒæŠ€æœ¯å®ç°

### âœ… **Elasticsearch ä¸‰è¡¨å®½è¡¨åŒæ­¥**ï¼ˆ`biz-review-job`ï¼‰
- å°† `review_info`ã€`review_reply_info`ã€`review_appeal_info` èšåˆä¸ºå•ä¸ª ES æ–‡æ¡£ï¼›
- å®½è¡¨åŒ…å«è¯„ä»·å†…å®¹ã€è¯„åˆ†ã€åª’ä½“ã€å•†å®¶å›å¤ã€ç”³è¯‰çŠ¶æ€ã€å®¡æ ¸æ„è§ç­‰å…¨é‡ä¿¡æ¯ï¼›
- ä½¿ç”¨ **ik_max_word** åˆ†è¯å™¨æ”¯æŒä¸­æ–‡æ£€ç´¢ã€‚

> å®ç°ï¼š[`biz-review-job/internal/job/model/biz-review.json`](https://github.com/STAR0903/biz-review-job/blob/main/internal/job/model/biz-review.json)

### âœ… **å¤æ‚ ES æŸ¥è¯¢å¼•æ“**ï¼ˆ`biz-review-service`ï¼‰
- æ”¯æŒç»„åˆæ¡ä»¶ï¼šSPUã€åº—é“ºã€è¯„åˆ†åŒºé—´ã€æ ‡ç­¾ã€æ—¶é—´èŒƒå›´ã€å®¡æ ¸çŠ¶æ€ï¼›
- æ·±åº¦åˆ†é¡µï¼š`search_after` æ›¿ä»£ `from/size`ï¼Œä¸‡çº§åˆ†é¡µæ— æ€§èƒ½è¡°å‡ï¼›
- æ’åºï¼šé»˜è®¤ä¼˜å…ˆå±•ç¤ºæœ‰å›¾ã€è§†é¢‘æˆ–å•†å®¶å›å¤çš„é«˜å‚è€ƒåº¦è¯„ä»·ã€‚ä¹Ÿå¯ä»¥é€‰æ‹©æ—¶é—´ã€è¯„åˆ†ã€å›å¤æ•°ç­‰å› ç´ æ’åºï¼›
- æ€§èƒ½ä¼˜åŒ–ï¼š`Bool Query` + `Filter Context`ï¼Œé¿å…ç›¸å…³æ€§è®¡ç®—ï¼Œæå‡ç¼“å­˜å‘½ä¸­ï¼›
- é«˜å¹¶å‘ä¿æŠ¤ï¼š`singleflight` åˆå¹¶è¯·æ±‚ + Redis ç¼“å­˜ã€‚

> ğŸ“„ å®ç°ï¼š[`biz-review-service/internal/biz/review.go`](https://github.com/STAR0903/biz-review-service/blob/main/internal/biz/review.go)

---

## æŠ€æœ¯æ ˆ

- **å¾®æœåŠ¡**ï¼šKratos v2.7.0
- **é€šä¿¡**ï¼šProtobuf + gRPCï¼ˆå†…éƒ¨ï¼‰ / HTTPï¼ˆå¤–éƒ¨ï¼‰
- **å†™å­˜å‚¨**ï¼šMySQL
- **è¯»å­˜å‚¨**ï¼šElasticsearch
- **ç¼“å­˜**ï¼šRedis + singleflight
- **æ•°æ®åŒæ­¥**ï¼šCanal â†’ Kafka â†’ Job
- **æœåŠ¡æ²»ç†**ï¼šConsul
- **å·¥ç¨‹åŒ–**ï¼šWireã€GORM Genã€protoc-gen-validate

---

## ç›¸å…³ä»“åº“

- ğŸ”¹ [`biz-review-service`](https://github.com/STAR0903/biz-review-service) â€” è¯„ä»·æœåŠ¡ç«¯
- ğŸ”¹ [`biz-review-api`](https://github.com/STAR0903/biz-review-api) â€” è¯„ä»·æœåŠ¡ç«¯ API å®šä¹‰
- ğŸ”¹ [`biz-review-c`](https://github.com/STAR0903/biz-review-c) â€” ç”¨æˆ·ç«¯
- ğŸ”¹ [`biz-review-b`](https://github.com/STAR0903/biz-review-b) â€” å•†å®¶ç«¯
- ğŸ”¹ [`biz-review-o`](https://github.com/STAR0903/biz-review-o) â€” è¿è¥ç«¯
- ğŸ”¹ [`biz-review-job`](https://github.com/STAR0903/biz-review-job) â€” è¯„ä»·æœåŠ¡ç«¯åŒæ­¥ä»»åŠ¡

---

